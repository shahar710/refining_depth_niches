---
title: "study_map"
author: "Shahar Chaikin"
date: "2025-04-12"
output: html_document
---
Libraries
```{r}
library(ggplot2)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggspatial) # For annotation_north_arrow and annotation_scale
library(grid)     # For viewport
```
Map
```{r}
# Download high-resolution Natural Earth data
world <- ne_countries(scale = "large", returnclass = "sf")  # Using medium scale for reliability

# Define your latitude and longitude lines
latitudes <- seq(26,40, by=2)
longitudes <- seq(22,40,by=4)

# Create the plot
main_map=ggplot() +
  # Add Natural Earth countries - fill with light gray, borders in black
  geom_sf(data = world, fill = "#FCF5BC", color = "gray50",linewidth = 0.01) +
  # Add grid lines
  geom_hline(yintercept = latitudes, color = "gray50", linetype = 1, linewidth = 0.2,alpha=0.2) +
  geom_vline(xintercept = longitudes, color = "gray50", linetype = 1, linewidth = 0.2,alpha=0.2) +
  # Set coordinate limits and CRS
  coord_sf(
    xlim = c(min(longitudes), max(longitudes)),
  ylim = c(min(latitudes), max(latitudes)),
  crs = st_crs(4326),
  expand = FALSE
  ) +
  scale_x_continuous(breaks = longitudes, labels = scales::label_number(suffix = "°E")) +
  # Theme adjustments
  theme_bw() +
  theme(
    panel.background = element_rect(fill = "white"),
  panel.grid = element_blank(),
  axis.title = element_blank(),
  plot.background = element_rect(fill = "white", color = NA))
main_map
```
# Create the Inset Map
```{r}
# Define the extent for the inset map (e.g., the whole Mediterranean region)
inset_bbox <- c(xmin = 34.87, xmax = 35.16, ymin = 32.8, ymax = 33.1)

# Download world data for the inset
world_inset <- ne_countries(scale = "large", returnclass = "sf")

# Create the inset map
inset_map <- ggplot() +
  geom_sf(data = world_inset, fill = "#FCF5BC", color = "black", linewidth = 0.2) +
  coord_sf(
    xlim = inset_bbox[1:2],
    ylim = inset_bbox[3:4],
    crs = st_crs(4326),
    expand = FALSE
  ) +
    scale_x_continuous(breaks = c(34.9,35,35.1), labels = scales::label_number(suffix = "°E"))+
      scale_y_continuous(breaks = c(32.85,32.95,33.05), labels = scales::label_number(suffix = "°E"))+
  theme_bw() + # A minimal theme without axis labels/ticks
  theme(panel.background = element_rect(fill = "white", color = NA),
        axis.text = element_blank(),
        axis.ticks = element_blank()) # Make the sea visible
inset_map
```

# Create the Second Inset Map
```{r}
# Define the extent for the inset map (e.g., the whole Mediterranean region)
inset2_bbox <- c(xmin = 34.75, xmax = 35.1, ymin = 29.35, ymax = 29.6)

# Download world data for the inset
world_inset2 <- ne_countries(scale = "large", returnclass = "sf")

# Create the inset map
inset2_map <- ggplot() +
  geom_sf(data = world_inset2, fill = "#FCF5BC", color = "black", linewidth = 0.00000) +
  coord_sf(
    xlim = inset2_bbox[1:2],
    ylim = inset2_bbox[3:4],
    crs = st_crs(4326),
    expand = FALSE
  ) +
    scale_x_continuous(breaks = c(34.9,35,35.1), labels = scales::label_number(suffix = "°E"))+
      scale_y_continuous(breaks = c(32.85,32.95,33.05), labels = scales::label_number(suffix = "°E"))+
  theme_bw() + # A minimal theme without axis labels/ticks
  theme(panel.background = element_rect(fill = "white", color = NA),
        axis.text = element_blank(),
        axis.ticks = element_blank()) # Make the sea visible
inset2_map
```

# Position the Inset Map
```{r}
# Define the viewport for the inset map
# These values are relative to the main plot area (0 to 1)
# x = horizontal center, y = vertical center, width, height
inset_viewport <- viewport(x = 0.2, y = 0.8, width = 0.3, height = 0.3)

# Print the main map with the inset
print(main_map)
print(inset_map, vp = inset_viewport)
```

```{r}
# --- Function to Print Both Plots with Viewport (Corrected) ---
print_combined_map <- function() {
  grid.newpage() # Start a new grid layout

  # Define viewports for the main map and the inset
  main_vp <- viewport(layout.pos.row = 1, layout.pos.col = 1)
  inset_vp <- viewport(x = 0.75, y = 0.25, width = 0.3, height = 0.3)

  # Create a layout with one cell (for the main map)
  pushViewport(viewport(layout = grid.layout(1, 1)))
  print(main_map, vp = main_vp) # Print the main map in the layout
  upViewport() # Go back to the main viewport

  # Print the inset map in its specified viewport
  print(inset_map, vp = inset_vp)
}

# --- Export the Combined Plot using ggsave ---
ggsave("combined_map.png", plot = { print_combined_map() }, width = 10, height = 8, units = "in", dpi = 300)


```

